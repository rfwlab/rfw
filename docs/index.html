<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>rfw Documentation</title>
        <link rel="stylesheet" href="/tailwind.css" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark-dimmed.min.css"
        />
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
            rel="stylesheet"
        />
        <script src="/rtml.js"></script>
    </head>
    <body class="bg-lightbg dark:bg-darkbg text-black dark:text-white">
        <div id="app"></div>
        <script src="/wasm_exec.js"></script>
        <script>
            // Basic loader for WASM files with a customizable progress bar
            (function (global) {
                function createBar(opts) {
                    const bar = document.createElement("div");
                    const color = opts.color || "#ff0000";
                    const blur = opts.blur || "8px";
                    Object.assign(bar.style, {
                        position: "fixed",
                        top: 0,
                        left: 0,
                        width: "0%",
                        height: opts.height || "4px",
                        background: color,
                        boxShadow: `0 0 ${blur} ${color}`,
                        zIndex: 9999,
                        transition: "width 0.3s ease",
                    });
                    document.body.appendChild(bar);
                    return {
                        start() {
                            let progress = 0;
                            this.interval = setInterval(() => {
                                progress = Math.min(progress + Math.random() * 10, 90);
                                bar.style.width = progress + "%";
                            }, 200);
                        },
                        finish() {
                            clearInterval(this.interval);
                            bar.style.width = "100%";
                            setTimeout(() => bar.remove(), 300);
                        },
                    };
                }
                async function load(url, { go, color, height, blur, skipLoader } = {}) {
                    let bar;
                    if (!skipLoader) {
                        bar = createBar({ color, height, blur });
                        bar.start();
                    }
                    const resp = await fetch(url);
                    const bytes = await resp.arrayBuffer();
                    if (bar) bar.finish();
                    const result = await WebAssembly.instantiate(bytes, go.importObject);
                    go.run(result.instance);
                    return result;
                }
                global.WasmLoader = { load };
            })(window);
        </script>
        <script>
            const go = new Go();
            marked.setOptions({
                highlight: (code, lang) => {
                    if (lang && hljs.getLanguage(lang)) {
                        return hljs.highlight(code, { language: lang }).value;
                    }
                    return hljs.highlightAuto(code).value;
                },
            });
            WasmLoader.load("/app.wasm?" + Date.now(), {
                go: go,
                color: "#ff0000",
                height: "4px",
                blur: "4px",
            });
        </script>
    </body>
</html>
